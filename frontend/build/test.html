<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ - é¡§å®¢ç®¡ç†ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        .test-title {
            color: #1976d2;
            font-size: 24px;
            margin-bottom: 16px;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 8px;
        }
        .test-section {
            margin-bottom: 24px;
        }
        .test-button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            transition: background 0.2s;
        }
        .test-button:hover {
            background: #1565c0;
        }
        .test-button.success {
            background: #4caf50;
        }
        .test-button.error {
            background: #f44336;
        }
        .test-results {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #4caf50; }
        .status-error { background: #f44336; }
        .status-warning { background: #ff9800; }
        .status-info { background: #2196f3; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ§ª Phase 3: çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h3><span class="status-indicator status-info"></span>ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª</h3>
            <button class="test-button" onclick="checkServerStatus()">ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯</button>
            <button class="test-button" onclick="checkAPIConnection()">APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        </div>

        <div class="test-section">
            <h3><span class="status-indicator status-warning"></span>èªè¨¼ãƒ•ãƒ­ãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="testLoginFlow()">ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ</button>
            <button class="test-button" onclick="testLogoutFlow()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ</button>
            <button class="test-button" onclick="testErrorHandling()">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <div class="test-section">
            <h3><span class="status-indicator status-warning"></span>ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="testMockMode()">ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="testAPIMode()">APIãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="compareResponseTimes()">ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦æ¯”è¼ƒ</button>
        </div>

        <div class="test-section">
            <h3><span class="status-indicator status-info"></span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹æ¤œè¨¼</h3>
            <button class="test-button" onclick="testLoadingStates()">ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç¢ºèª</button>
            <button class="test-button" onclick="testNotifications()">é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª</button>
            <button class="test-button" onclick="testResponsiveDesign()">ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèª</button>
        </div>

        <div id="test-results" class="test-results"></div>
    </div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testResults.push({ message: logEntry, type });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = testResults.map(result => {
                const colorClass = {
                    'success': 'color: #4caf50',
                    'error': 'color: #f44336',
                    'warning': 'color: #ff9800',
                    'info': 'color: #2196f3'
                }[result.type] || 'color: #333';
                return `<div style="${colorClass}">${result.message}</div>`;
            }).join('');
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª
        async function checkServerStatus() {
            log('ğŸ” ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèªã‚’é–‹å§‹...', 'info');
            
            try {
                // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç¢ºèª
                const frontendResponse = await fetch('http://localhost:3001');
                if (frontendResponse.ok) {
                    log('âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼: æ­£å¸¸ç¨¼åƒ (Port 3001)', 'success');
                } else {
                    log('âŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼: å¿œç­”ã‚¨ãƒ©ãƒ¼', 'error');
                }

                // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç¢ºèª
                const backendResponse = await fetch('http://localhost:3000/api/health');
                if (backendResponse.ok) {
                    const data = await backendResponse.json();
                    log(`âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼: æ­£å¸¸ç¨¼åƒ (${data.environment})`, 'success');
                    log(`ğŸ“Š ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${data.timestamp}`, 'info');
                } else {
                    log('âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼: å¿œç­”ã‚¨ãƒ©ãƒ¼', 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ ã‚µãƒ¼ãƒãƒ¼ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function checkAPIConnection() {
            log('ğŸ”— APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/config');
                if (response.ok) {
                    const config = await response.json();
                    log('âœ… APIæ¥ç¶š: æˆåŠŸ', 'success');
                    log(`ğŸ”§ Google OAuth: ${config.google.enabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}`, 'info');
                    log(`ğŸ” MFA: ${config.security.mfaEnabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}`, 'info');
                } else {
                    log(`âŒ APIæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ APIæ¥ç¶šå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
        async function testLoginFlow() {
            log('ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            try {
                const loginData = {
                    email: 'test@company.com',
                    password: 'password'
                };

                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'http://localhost:3001'
                    },
                    body: JSON.stringify(loginData)
                });

                if (response.ok) {
                    const data = await response.json();
                    log('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ', 'success');
                    log(`ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data.user.fullName} (${data.user.role})`, 'info');
                    log(`ğŸ« ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³: ${data.accessToken.substring(0, 20)}...`, 'info');
                    log(`â° æœ‰åŠ¹æœŸé™: ${data.expiresIn}ç§’`, 'info');
                    
                    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã—ã¦ã•ã‚‰ãªã‚‹ãƒ†ã‚¹ãƒˆã«ä½¿ç”¨
                    localStorage.setItem('testAccessToken', data.accessToken);
                } else {
                    const errorData = await response.json();
                    log(`âŒ ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ${errorData.error}`, 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
        async function testLogoutFlow() {
            log('ğŸ‘‹ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'http://localhost:3001'
                    },
                    body: JSON.stringify({})
                });

                if (response.ok) {
                    log('âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ', 'success');
                    localStorage.removeItem('testAccessToken');
                } else {
                    log(`âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¤±æ•—: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        async function testErrorHandling() {
            log('ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            // ä¸æ­£ãªèªè¨¼æƒ…å ±ãƒ†ã‚¹ãƒˆ
            try {
                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'http://localhost:3001'
                    },
                    body: JSON.stringify({ email: '', password: '' })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    log(`âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ­£å¸¸: ${errorData.error}`, 'success');
                } else {
                    log('âŒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç•°å¸¸: ä¸æ­£å…¥åŠ›ãŒå—ã‘å…¥ã‚Œã‚‰ã‚ŒãŸ', 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
        async function testMockMode() {
            log('ğŸ­ ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            log('ğŸ“ æ³¨æ„: ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã¯ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡ã•ã‚Œã¾ã™', 'warning');
            log('ğŸ”§ REACT_APP_USE_MOCK_API=true ã§ãƒ¢ãƒƒã‚¯æœ‰åŠ¹', 'info');
            
            // å®Ÿéš›ã®ãƒ¢ãƒ¼ãƒ‰ç¢ºèªã¯ç’°å¢ƒå¤‰æ•°ã«ä¾å­˜ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯èª¬æ˜ã®ã¿
            log('âœ… ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰è¨­å®šç¢ºèªå®Œäº†', 'success');
        }

        // APIãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
        async function testAPIMode() {
            log('ğŸŒ APIãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            log('ğŸ”§ REACT_APP_USE_MOCK_API=false ã§APIæœ‰åŠ¹', 'info');
            
            // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ç¢ºèª
            const currentMode = localStorage.getItem('testAccessToken') ? 'APIæ¥ç¶šä¸­' : 'APIæœªæ¥ç¶š';
            log(`ğŸ“Š ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰: ${currentMode}`, 'info');
            log('âœ… APIãƒ¢ãƒ¼ãƒ‰è¨­å®šç¢ºèªå®Œäº†', 'success');
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦æ¯”è¼ƒ
        async function compareResponseTimes() {
            log('âš¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦æ¯”è¼ƒã‚’é–‹å§‹...', 'info');
            
            const startTime = performance.now();
            try {
                await fetch('http://localhost:3000/api/health');
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                log(`ğŸ“Š API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${responseTime}ms`, 'info');
                
                if (responseTime < 100) {
                    log('âœ… å„ªç§€ãªå¿œç­”é€Ÿåº¦', 'success');
                } else if (responseTime < 500) {
                    log('âš ï¸ æ™®é€šã®å¿œç­”é€Ÿåº¦', 'warning');
                } else {
                    log('âŒ é…ã„å¿œç­”é€Ÿåº¦', 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ é€Ÿåº¦æ¸¬å®šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç¢ºèª
        function testLoadingStates() {
            log('â³ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç¢ºèªã‚’é–‹å§‹...', 'info');
            log('ğŸ“ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®è¡¨ç¤ºã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'info');
            log('âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç¢ºèªå®Œäº†', 'success');
        }

        // é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª
        function testNotifications() {
            log('ğŸ”” é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªã‚’é–‹å§‹...', 'info');
            log('ğŸ“ æˆåŠŸ/ã‚¨ãƒ©ãƒ¼/æƒ…å ±é€šçŸ¥ã®è¡¨ç¤ºã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'info');
            log('âœ… é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªå®Œäº†', 'success');
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèª
        function testResponsiveDesign() {
            log('ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèªã‚’é–‹å§‹...', 'info');
            log('ğŸ“ ç”»é¢ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'info');
            log('âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèªå®Œäº†', 'success');
        }

        // åˆæœŸåŒ–æ™‚ã«ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        window.onload = function() {
            log('ğŸš€ Phase 3 çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            log('ğŸ“Š ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:3001', 'info');
            log('ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: http://localhost:3000', 'info');
            log('ğŸ”¥ æº–å‚™å®Œäº† - ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„', 'success');
        };
    </script>
</body>
</html>