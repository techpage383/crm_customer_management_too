#!/bin/bash

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆçµ„ç¹”å†…å…±æœ‰ç”¨ï¼‰

echo "ğŸš€ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™"

# ç¾åœ¨ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
IP_ADDRESS=$(hostname -I | awk '{print $1}')

echo "ğŸ“ ã‚ãªãŸã®IPã‚¢ãƒ‰ãƒ¬ã‚¹: $IP_ADDRESS"

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
echo "ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ä¸­..."
cd frontend
BROWSER=none HOST=0.0.0.0 npm start &
FRONTEND_PID=$!

# å°‘ã—å¾…ã¤
sleep 3

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
echo "ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ä¸­..."
cd ../backend
HOST=0.0.0.0 npm run dev &
BACKEND_PID=$!

echo ""
echo "âœ… ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¾ã—ãŸï¼"
echo ""
echo "ğŸŒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚¯ã‚»ã‚¹:"
echo "   ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:3000"
echo "   ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API: http://localhost:3000"
echo ""
echo "ğŸ‘¥ ãƒãƒ¼ãƒ å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹:"
echo "   ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://${IP_ADDRESS}:3000"
echo "   ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API: http://${IP_ADDRESS}:3000"
echo ""
echo "ğŸ›‘ çµ‚äº†ã™ã‚‹ã«ã¯ Ctrl+C ã‚’æŠ¼ã—ã¦ãã ã•ã„"

# çµ‚äº†æ™‚ã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
cleanup() {
    echo "ğŸ›‘ ã‚µãƒ¼ãƒãƒ¼ã‚’çµ‚äº†ã—ã¦ã„ã¾ã™..."
    kill $FRONTEND_PID $BACKEND_PID 2>/dev/null
    exit 0
}

trap cleanup SIGINT SIGTERM

# ãƒ—ãƒ­ã‚»ã‚¹ãŒç”Ÿãã¦ã„ã‚‹é–“å¾…æ©Ÿ
wait